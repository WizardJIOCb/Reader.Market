# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: Badge –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞
- ‚úÖ Badge –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é (navbar) –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- ‚ùå Badge –≤ —Å–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–ª–µ–≤–∞ –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

## –®–∞–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3001/messages`
2. –ù–∞–∂–º–∏—Ç–µ **F12** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Console**
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å (–∏–∫–æ–Ω–∫–∞ üö´ –∏–ª–∏ Ctrl+L)

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
```
Setting up global message listener for conversation list updates
Setting up global notification listener for conversation list updates
Setting up global channel message listener for group list updates
```

‚úÖ **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚ùå **–ï—Å–ª–∏ –ù–ï –≤–∏–¥–∏—Ç–µ** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤—Ç–æ—Ä–æ–µ –æ–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞ (–¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –ø–µ—Ä–≤–æ–≥–æ –æ–∫–Ω–∞

**–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:**
```
Global notification listener: notification received {type: "new_message", ...}
Fetching conversations...
Conversations response status: 200
Conversations data received: Array(X)
First conversation: {...}
Unread counts per conversation:
  1. username: unreadCount = 3
üîÑ Updating conversations state with X conversations
‚úÖ setConversations called - React should re-render now
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ

–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –æ–±—ä–µ–∫—Ç `First conversation` –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```javascript
{
  "id": "...",
  "otherUser": {...},
  "lastMessage": {...},
  "updatedAt": "...",
  "unreadCount": 3  // <-- –≠—Ç–æ –ø–æ–ª–µ –î–û–õ–ñ–ù–û –±—ã—Ç—å –∑–¥–µ—Å—å!
}
```

#### –ï—Å–ª–∏ unreadCount === undefined
‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –±—ç–∫–µ–Ω–¥–µ** - —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

#### –ï—Å–ª–∏ unreadCount === 0
‚ö†Ô∏è **–í –±–∞–∑–µ –Ω–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**
**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—â–µ —Å–æ–æ–±—â–µ–Ω–∏—è

#### –ï—Å–ª–∏ unreadCount > 0
‚úÖ **–î–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ!**
–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ React

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DOM

–í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```javascript
// –ü–æ—Å—á–∏—Ç–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ DOM
document.querySelectorAll('[class*="p-4 border-b cursor-pointer"]').length
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–∏–∞–ª–æ–≥–æ–≤

// –ü–æ—Å—á–∏—Ç–∞—Ç—å badges
document.querySelectorAll('[class*="absolute -bottom-1 -left-1"]').length
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–∏–∞–ª–æ–≥–æ–≤ —Å unreadCount > 0
```

#### –ï—Å–ª–∏ badges.length === 0 –Ω–æ unreadCount > 0
‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ React**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –£—Å–ª–æ–≤–∏–µ `{conv.unreadCount > 0 &&` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
2. React –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
3. CSS —Å–∫—Ä—ã–≤–∞–µ—Ç badge

### –®–∞–≥ 6: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `debug_conversation_badges.js` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –í—Å—Ç–∞–≤—å—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ debug_conversation_badges.js
// –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
window.debugConversations()
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ DOM
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–∏–º—ã—Ö badges
- –ü—Ä–∏—á–∏–Ω—É, –ø–æ—á–µ–º—É badges –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network Tab

1. **DevTools ‚Üí Network**
2. –§–∏–ª—å—Ç—Ä: **XHR**
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
4. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/conversations`
5. –ö–ª–∏–∫–Ω–∏—Ç–µ ‚Üí **Response** tab
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JSON –æ—Ç–≤–µ—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π Response:**
```json
[
  {
    "id": "conv-id",
    "otherUser": {...},
    "lastMessage": {...},
    "updatedAt": "2026-01-07...",
    "unreadCount": 3  // <-- –ü–†–û–í–ï–†–¨–¢–ï –≠–¢–û –ü–û–õ–ï!
  }
]
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –î–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ UI –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: `unreadCount = 3`
- ‚úÖ –í Network tab: `unreadCount: 3`
- ‚ùå –í UI: badge –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** React –Ω–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ —É—Å–ª–æ–≤–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
const convs = document.querySelectorAll('[class*="p-4 border-b"]');
console.log('Conversation elements:', convs.length);

// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:
console.log(convs[0].innerHTML);
// –î–æ–ª–∂–µ–Ω –±—ã—Ç—å <div class="relative"> —Å <div class="absolute -bottom-1 -left-1">
```

### –°—Ü–µ–Ω–∞—Ä–∏–π B: unreadCount –≤—Å–µ–≥–¥–∞ 0

**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚ùå `unreadCount = 0` –≤ API –æ—Ç–≤–µ—Ç–µ

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—ç–∫–µ–Ω–¥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ë–î:
```sql
SELECT * FROM messages 
WHERE recipient_id = 'YOUR_USER_ID' 
  AND read_status = false 
  AND deleted_at IS NULL;
```

### –°—Ü–µ–Ω–∞—Ä–∏–π C: fetchConversations –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚ùå –ù–µ—Ç –ª–æ–≥–æ–≤ "Fetching conversations..."
- ‚ùå –ù–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ Network tab

**–ü—Ä–∏—á–∏–Ω–∞:** WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+Shift+R)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–∏—Ç–µ "Setting up global notification listener"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ Network ‚Üí WS

### –°—Ü–µ–Ω–∞—Ä–∏–π D: –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- Badge –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã badge –∏—Å—á–µ–∑–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** React state –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –§–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
window.location.reload();
```

## –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É:

- [ ] –ö–æ–Ω—Å–æ–ª—å: "Setting up global notification listener" –µ—Å—Ç—å?
- [ ] –ö–æ–Ω—Å–æ–ª—å: "Global notification listener: notification received" –ø–æ—è–≤–ª—è–µ—Ç—Å—è?
- [ ] –ö–æ–Ω—Å–æ–ª—å: "Fetching conversations..." –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è?
- [ ] –ö–æ–Ω—Å–æ–ª—å: `unreadCount` > 0 –≤ –¥–∞–Ω–Ω—ã—Ö?
- [ ] Network: `/api/conversations` –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è?
- [ ] Network: Response —Å–æ–¥–µ—Ä–∂–∏—Ç `unreadCount` > 0?
- [ ] DOM: –ï—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã `[class*="p-4 border-b"]`?
- [ ] DOM: –ï—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã `[class*="absolute -bottom-1 -left-1"]`?

## –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

### –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```powershell
# 1. –£–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node
Stop-Process -Name node -Force

# 2. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
# Ctrl+Shift+Delete ‚Üí –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∑–∞–Ω–æ–≤–æ
npm run dev

# 4. –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
# Ctrl+Shift+N
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `Messages.tsx` –µ—Å—Ç—å:

1. **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ notification (—Å—Ç—Ä–æ–∫–∏ ~265-283):**
```typescript
useEffect(() => {
  const cleanupNotification = onSocketEvent('notification:new', (data) => {
    if (data.type === 'new_message') {
      fetchConversations();
      window.dispatchEvent(new CustomEvent('update-unread-count'));
    }
  });
  return () => cleanupNotification();
}, []);
```

2. **Badge –≤ —Ä–µ–Ω–¥–µ—Ä–µ (—Å—Ç—Ä–æ–∫–∏ ~1070-1087):**
```typescript
{conv.unreadCount > 0 && (
  <div className="absolute -bottom-1 -left-1 ...">
    {conv.unreadCount > 99 ? '99+' : conv.unreadCount}
  </div>
)}
```

## –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á—ë—Ç–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, —Å–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

1. **–°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏** —Å –ª–æ–≥–∞–º–∏
2. **–°–∫—Ä–∏–Ω—à–æ—Ç Network tab** —Å –∑–∞–ø—Ä–æ—Å–æ–º `/api/conversations`
3. **–°–∫—Ä–∏–Ω—à–æ—Ç Response tab** —Å JSON –¥–∞–Ω–Ω—ã–º–∏
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç `window.debugConversations()`**

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã.

## –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

–ü–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ, —á–∞—â–µ –≤—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤:

1. **70%** - –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω, —Å—Ç–∞—Ä—ã–π –∫–æ–¥
2. **20%** - –ö—ç—à –±—Ä–∞—É–∑–µ—Ä–∞, —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **5%** - WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. **5%** - –ü—Ä–æ–±–ª–µ–º—ã —Å React state

**–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∂—ë—Å—Ç–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R).**
